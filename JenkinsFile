pipeline {
    agent any
 tools {
    maven 'choco_maven'
 }

stages {
    stage ('checkout') {
        steps {
            git branch: 'master', url: 'https://github.com/eKuuuuu/OTP1_tuntitehtava_2.git'
        }

    }
    stage ('build') {
        steps {
        bat 'mvn clean install'
            echo 'build success'
        }
    }

    stage ('test') {
        steps {
            echo 'runing test'
            bat 'mvn test jacoco:report'
            bat 'dir target/s'

        }
    }

}

post {
        always {
            // Publish JUnit test results
            junit '**/target/surefire-reports/*.xml'

            // Publish JaCoCo HTML report
            publishHTML([
                reportDir: 'target/site/jacoco',
                reportFiles: 'index.html',
                reportName: 'JaCoCo Coverage Report',
                alwaysLinkToLastBuild: true,
                keepAll: true,
                allowMissing: true
            ])

            echo 'Pipeline completed with tests and coverage.'
        }
    }



}